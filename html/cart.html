<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <script src="../js/jquery-3.7.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../css/cart.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>

<body>
    <!-- menu -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <!-- Logo -->
                <a class="navbar-brand" href="#">
                    <img src="../img/logo.png" alt="Logo" id="logo">
                </a>
                <!-- Nút collapse -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Menu -->
                <div class="collapse navbar-collapse order-lg-1" id="navbarNav">
                    <ul class="navbar-nav  ">
                        <li class="nav-item">
                            <a class="nav-link " href="../html/Trang chủ.html">Trang chủ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../html/Giới thiệu.html">Giới thiệu</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
                                Sản phẩm
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" href="../html/Bàn gỗ.html">
                                        Bàn gỗ
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="../html/Sofa.html">
                                        Sofa
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="../html/Tủ gỗ.html">
                                        Tủ gỗ
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="../html/cart.html">Giỏ hàng</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
                                Hỗ trợ
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" href="../html/Site map.html">
                                        Site map
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="../html/Thành viên.html">
                                        Thành viên
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="../html/Thông tin khách hàng.html">
                                        Thông tin khách hàng
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../html/Đăng nhập.html">Đăng nhập</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../html/Đăng ký.html">Đăng kí</a>
                        </li>
                    </ul>
                </div>

                <!-- Ô tìm kiếm-->
                <div class="d-flex order-lg-2">
                    <div class="input-group">
                        <input type="text" name="search" id="search" class="form-control btn-search-custom"
                            placeholder="Tìm kiếm...">
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="title-1">
            <h2>Giỏ hàng của bạn</h2>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Ảnh sản phẩm</th>
                    <th scope="col">Tên sản phẩm</th>
                    <th scope="col">Số lượng</th>
                    <th scope="col">Đơn giá</th>
                    <th scope="col">Thành tiền</th>
                    <th scope="col">Xóa</th> 
                </tr>
            </thead>
            <tbody id="cart-table-body">
            </tbody>
            <tfoot>
                <tr>
                    <th scope="row" colspan="5">Tổng</th>
                    <td id="total-amount"></td>
                </tr>
            </tfoot>
        </table>
        <button type="submit" class="btn btn-success" id="btnTT">Thanh toán</button>
    </div>
    <!-- footer -->
    <footer>
        <div class="row text-center row-cols-2 row-cols-md-4">
            <div class="title col-md-4">
                <div class="d-flex flex-column">
                    <p><i class="fa-solid fa-phone me-3"></i>Hotline</p>
                    <a class="nav-link" href="#">0123 456 789</a>
                    <a class="nav-link" href="#">0123 456 789</a>
                </div>
            </div>
            <div class="title col-md-4">
                <div class="d-flex flex-column align-items-center">
                    <p><i class="fa-solid fa-location-dot me-3"></i>Địa chỉ</p>
                    <p class="text-justify">
                        Số 12, Nguyễn Văn Bảo, <br> Phường 4, Quận Gò Vấp, <br> TP. Hồ Chí Minh
                    </p>
                </div>
            </div>
            <div class="title col-md-4">
                <p><i class="fa-solid fa-globe me-3"></i>Liên hệ</p>
                <ul class="nav justify-content-center">
                    <li class="nav-item">
                        <a href="#"><i class="fa-brands fa-facebook" id="icon-mxh"></i></a>
                    </li>
                    <li class="nav-item">
                        <a href="#"><i class="fa-brands fa-instagram" id="icon-mxh"></i></a>
                    </li>
                    <li class="nav-item">
                        <a href="#"><i class="fa-brands fa-youtube" id="icon-mxh"></i></a>
                    </li>
                    <li class="nav-item">
                        <a href="#"><i class="fa-brands fa-tiktok" id="icon-mxh"></i></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
    $(document).ready(function () {
    // Lấy giỏ hàng từ localStorage
    var cart = JSON.parse(localStorage.getItem('cart')) || [];
    var totalAmount = 0;

    // Kiểm tra nếu giỏ hàng có sản phẩm
    if (cart.length > 0) {
        // Duyệt qua các sản phẩm trong giỏ hàng và hiển thị
        cart.forEach(function (product, index) {
            var row = `
            <tr>
                <td><img src="${product.image}" alt="${product.tenSanPham}" style="width: 200px; height: auto; padding: 10px"></td>
                <td>${product.tenSanPham}</td>
                <td>${product.soLuong}</td>
                <td>${product.donGia.toLocaleString()} đ</td>
                <td>${product.thanhTien.toLocaleString()} đ</td>
                <td><button class="btn btn-danger btn-sm" onclick="removeProduct(${index})">Xóa</button></td>
            </tr>
            `;
            $('#cart-table-body').append(row);
            totalAmount += product.thanhTien;
        });

        // Cập nhật tổng thành tiền
        $('#total-amount').text(totalAmount.toLocaleString() + " đ");
    }

    // Xử lý sự kiện thanh toán
    $('#btnTT').on('click', function () {
        // Kiểm tra nếu người dùng đã đăng nhập
        var isLoggedIn = localStorage.getItem('isLoggedIn') === 'true'; // Kiểm tra trạng thái đăng nhập

        if (!isLoggedIn) {
            // Nếu chưa đăng nhập, thông báo và yêu cầu đăng nhập
            alert("Bạn cần đăng nhập để thực hiện thanh toán.");
            window.location.href = "../html/Đăng nhập.html";
            return; 
        }

        // Nếu đã đăng nhập, tiếp tục thanh toán
        localStorage.removeItem('cart'); // Xóa giỏ hàng trong localStorage
        $('#cart-table-body').empty(); // Làm mới lại giỏ hàng trên giao diện
        $('#total-amount').text('0 đ'); // Làm mới tổng tiền

        alert("Thanh toán thành công!!");
        window.location.href = "../html/cart.html";
    });
});

// Hàm xóa sản phẩm
function removeProduct(index) {
    var cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.splice(index, 1); // Xóa sản phẩm tại index
    localStorage.setItem('cart', JSON.stringify(cart)); // Cập nhật lại localStorage

    // Cập nhật lại giao diện giỏ hàng
    $('#cart-table-body').empty(); // Làm mới lại giỏ hàng trên giao diện
    var totalAmount = 0;
    cart.forEach(function (product, index) {
        var row = `
        <tr>
            <td><img src="${product.image}" alt="${product.tenSanPham}" style="width: 200px; height: auto; padding: 10px"></td>
            <td>${product.tenSanPham}</td>
            <td>${product.soLuong}</td>
            <td>${product.donGia.toLocaleString()} đ</td>
            <td>${product.thanhTien.toLocaleString()} đ</td>
            <td><button class="btn btn-danger btn-sm" onclick="removeProduct(${index})">Xóa</button></td>
        </tr>
        `;
        $('#cart-table-body').append(row);
        totalAmount += product.thanhTien;
    });
    $('#total-amount').text(totalAmount.toLocaleString() + " đ"); // Cập nhật tổng tiền
}
    </script>

</body>

</html>